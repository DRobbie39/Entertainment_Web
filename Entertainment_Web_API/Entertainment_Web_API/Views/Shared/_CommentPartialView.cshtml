@using BackEnd.Models
@using System.Security.Claims
@model Comment

@{
    var model = Model;
    var videoId = ViewData["videoId"] as string;
    var comments = ViewData["commentList"] as List<Comment>;
}

<!-- cop từ chỗ này-->
<div class="comment-box">
    <form asp-controller="Comment" asp-action="AddComment" method="post" class="d-flex">
        <div class="form-group" style="margin-right:10px">
            @* <input asp-for="Comments." value="-1" type="hidden" class="form-control" /> *@
            <input asp-for="VideoId" value="@videoId" type="hidden" class="form-control" />
        </div>
        <textarea asp-for="Content" class="comment-input"></textarea>
        <button type="submit" class="submit-button">Gửi</button>
    </form>
</div>

<div class="comment">
    <div class="row g-0 margin-top:8px d-flex">
        
        @if(comments != null)
        {
            @foreach (var comment in comments)
            {
                <div class="col-12 d-flex" style="margin-top:15px">
                    <div class="d-flex" style="width:95%;">
                        <img class="rounded-circle flex-shrink-0" src="/Uploads/@(comment.AppUser.Avtprofile ?? "avtmacdinh.jpg")" alt="" style="width: 40px; height: 40px;">
                        <div class="block col-10" style="margin-left:20px">
                            <h5 style="margin-top:3px;margin-left:5px;">@(comment.AppUser.FullName ?? "User")</h5>
                            <p style="margin-left:15px;">@comment.Content</p>
                        </div>
                        <div class="col-1 justify-content-start">
                            <small style="margin-left:20px;">@comment.CommentPostingTime</small>
                            @if(comment.Id == User.FindFirstValue(ClaimTypes.NameIdentifier))
                            {
                                <form asp-controller="Comment" asp-action="DeleteComment" method="post" class="d-flex">
                                <div class="form-group" style="margin-left:5px;margin-right:10px">
                                    <input asp-for="CommentId" value="@comment.CommentId" type="hidden" class="form-control" />
                                    <input asp-for="VideoId" value="@videoId" type="hidden" class="form-control" />
                                </div>

                                    <!-- Thêm ID cho nút chỉnh sửa -->

                                @* button delete comment *@
                                    <button type="submit" style=";border-radius:5px;" onclick="return confirmDelete()">
                                        <div class="d-flex clsss" >
                                            <i class="fa fa-trash" aria-hidden="true" style="padding:5px"></i>
                                     </div>
                                </button>
                                    <button type="submit" id="editButton" style="border-radius:5px;margin-left:3px;">
                                        @* button update comment *@
                                        <div class="d-flex clsss">
                                            <i class="bi bi-pencil-square" style="padding:5px;"></i>
                                        </div>
                                    </button>
                            </form>
                                

                                <!-- Thêm ô văn bản cho việc chỉnh sửa -->
            @* <textarea id="editedCommentInput" class="comment-input" style="display: none;"></textarea> *@
                            }                           
                        </div>                       
                    </div>    
                </div>
                @* <div class="comment-box col-1 d-inline">                   
                </div> *@
            }
        }
    </div>
    @* <script>
        // Lắng nghe sự kiện click trên nút chỉnh sửa
        document.getElementById('editButton').addEventListener('click', function () {
            // Hiển thị ô văn bản để người dùng nhập lại nội dung bình luận
            document.getElementById('editedCommentInput').style.display = 'block';

            // Thay đổi văn bản của nút từ "Edit" sang "OK"
            this.innerHTML = '<div class="d-flex clsss"><i class="bi bi-check-square" style="margin-top:5px;margin-right:8px"></i></div>';

            // Gửi dữ liệu bình luận đã chỉnh sửa lên server bằng AJAX
            $.ajax({
                url: '/Comment/UpdateComment', // Thay đổi URL tương ứng với action của bạn
                type: 'PUT', // Thay đổi method tương ứng với action của bạn
                data: {
                    commentId: commentId, // Thay đổi commentId tương ứng
                    content: editedCommentContent
                },
                success: function (response) {
                    // Xử lý kết quả từ server (thành công)
                    alert('Bình luận đã được cập nhật thành công!');
                },
                error: function () {
                    // Xử lý kết quả từ server (thất bại)
                    alert('Cập nhật bình luận thất bại!');
                }
            });
        });
    </script> *@
    <script>
        function confirmDelete() {
            return confirm("Bạn có chắc chắn muốn xóa bình luận này?");
        }
    </script>
</div>
<!-- đến đây là kết thúc comment-->
